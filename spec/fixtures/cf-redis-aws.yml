---
name: cf-redis
director_uuid: 6416c797-24bc-412c-9167-e4f4dc2365d9

releases:
- name: cf-redis
  version: latest

compilation:
  workers: 2
  network: services1
  reuse_compilation_vms: true
  cloud_properties:
    instance_type: m3.medium

update:
  canaries: 1
  canary_watch_time: 30000-180000
  update_watch_time: 30000-180000
  max_in_flight: 4

networks:
- name: services1
  type: manual
  subnets:
  - range: 10.202.84.0/25   #check cidr in aws
    gateway: 10.202.84.1   # alwayse first ip in the range
    # Amazon reserves the first four IPs and the last IP for networking purposes
    reserved:
    - 10.202.84.2 - 10.202.84.8
    - 10.202.84.18 - 10.202.84.20
    - 10.202.84.34
    - 10.202.84.46
    - 10.202.84.92
    static:
    - 10.202.84.93 - 10.202.84.97 # dedicated deployments
    - 10.202.84.98  #broker node
    dns:
    - 10.202.95.105  #DNS - is it ok to use same dns
    cloud_properties:
      subnet: subnet-55d8047e
- name: vip_network
  type: vip
  # Fake network properties to satisfy bosh diff
  subnets:
  - range: 127.0.99.0/24
    gateway: 127.0.99.1
    dns:
    - 127.0.99.250
  cloud_properties:
    security_groups:
    - bosh

resource_pools:
- name: services-small
  network: services1
  stemcell:
    name: bosh-aws-xen-ubuntu-trusty-go_agent
    version: latest
  cloud_properties:
    instance_type: m3.medium

jobs:
  - name: cf-redis-broker
    templates:
    - name: cf-redis-broker
      release: cf-redis
    - name: syslog-configurator
      release: cf-redis
    instances: 1
    resource_pool: services-small
    persistent_disk: 4096
    networks:
    - name: services1
      static_ips:
      - 10.202.84.98  #Broker node

  - name: dedicated-node
    templates:
    - name: dedicated-node
      release: cf-redis
    - name: syslog-configurator
      release: cf-redis
    instances: 1
    resource_pool: services-small
    persistent_disk: 4096
    networks:
    - name: services1
      static_ips:
      - 10.202.84.93  #dedicated node

  - name: broker-registrar
    instances: 1
    lifecycle: errand
    networks:
    - name: services1
    resource_pool: services-small
    templates:
    - name: broker-registrar
      release: cf-redis

  - name: broker-deregistrar
    instances: 1
    lifecycle: errand
    networks:
    - name: services1
    resource_pool: services-small
    templates:
    - name: broker-deregistrar
      release: cf-redis

properties:
# multi tenant plan
  broker:
    name: redis
    host: 10.202.84.98  # broker ip
    username: admin
    password: redisc1oudc0w
  syslog_aggregator:
    address: #REPLACE_WITH_SYSLOG_AGGREGATOR_HOST
    port: #REPLACE_WITH_SYSLOG_AGGREGATOR_PORT
  cf:
    api_url: https://api.grc-apps.svc.ice.ge.com
    admin_username: admin
    admin_password: BtIJNGJlVRHqcdgiWFIW
  redis:
  # dedicated plan
    host: 10.202.84.98  # broker ip
    broker:
      service_instance_limit: 5
      dedicated_nodes:
      - 10.202.84.93  #dedicated node
      dedicated_port: 6379
      auth:
        username: admin
        password: redisc1oudc0w
    config_command: "config"
